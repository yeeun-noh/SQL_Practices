--10일차

CREATE TABLE SAMPLE (
    ID NUMBER(4),
    NAME VARCHAR2(20),
    PW VARCHAR2(10)
);


SELECT * FROM SAMPLE;


INSERT INTO SAMPLE
VALUES(1, 'kim', 'a123');


INSERT INTO SAMPLE
VALUES(2, null, null);


INSERT INTO SAMPLE(ID)
VALUES(1);


DROP TABLE SAMPLE;


--빈값을 허락하지 않는 NOT NULL (NULL추가시, 오류발생)
--테이블을 생성할때 NOT NULL 설정하기:
CREATE TABLE SAMPLE (
    ID NUMBER(4) NOT NULL,
    NAME VARCHAR2(20) NOT NULL,
    PW VARCHAR2(10) NOT NULL
);


SELECT * FROM SAMPLE;


--PRIMARY KEY : 기본키, 유일하게 하나만 있는 값(유일키, 중복안됨, NULL허용안됨) 
--테이블을 생성할때 특정 열에 PRIMARY KEY 설정하기:
CREATE TABLE SAMPLE2 (
    LOGIN_ID VARCHAR(20) PRIMARY KEY,
    LOGIN_PWD VARCHAR(20) NOT NULL,
    TEL VARCHAR(20)
);


SELECT * FROM SAMPLE2;


INSERT INTO SAMPLE2(LOGIN_ID, LOGIN_PWD, TEL)
VALUES('abc', 'a100', '010-0000-1111');


INSERT INTO SAMPLE2(LOGIN_ID, LOGIN_PWD, TEL)
VALUES('abc1', 'a100', '010-0000-1111');


INSERT INTO SAMPLE2(LOGIN_ID, LOGIN_PWD)
VALUES('abc2', 'a100');


--제약조건의 이름을 직접 지정하여 테이블 생성하기:
CREATE TABLE DEPT_FK (
    DEPTNO NUMBER(2) CONSTRAINT DEPT_FK_DEPTNO_PK PRIMARY KEY,
    DNAME VARCHAR2(14),
    LOC VARCHAR2(13)
);


SELECT * FROM DEPT_FK;


--생성한 PRIMARY KEY 확인하기:
SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINT
WHERE TABLE_NAME LIKE '%DEPT_FK';


--DEPT_FK 테이블의 DEPTNO열을 참조하는 FOREIGN KEY 제약조건을 정의한 EMP_FK 테이블 생성하기:
--참조할때 REFERENCES사용 => REFERENCES 참조테이블(참조할열)
CREATE TABLE EMP_FK(
    EMPNO NUMBER(4) CONSTRAINT EMPFK_EMPNO_PK PRIMARY KEY,
    ENAME VARCHAR(20) NOT NULL,
    DEPTNO NUMBER(2) CONSTRAINT EMPFK_DEPTNO_FK REFERENCES DEPT_FK(DEPTNO) ON DELETE CASCADE
);


SELECT * FROM EMP_FK;
SELECT * FROM DEPT_FK;


--참조하는 테이블의 PRIMARY KEY를 먼저 값을 추가한 후, 참조받는 테이블의 값을 추가가능(FOREIGN KEY의 값이 PRIMARY KEY의 값과 같아야함, 참조무결성)
INSERT INTO DEPT_FK(DEPTNO, DNAME, LOC)
VALUES(12, 'a100', 12);


INSERT INTO EMP_FK(EMPNO, ENAME, DEPTNO)
VALUES(1234, 'a100', 12);

--삭제가능    => DELETE FROM EMP_FK WHERE DEPTNO = 12; (FORIEGN KEY이므로)
--삭제불가능  => DELETE FROM DEPT_FK WHERE DEPTNO = 12; (PRIMARY KEY이므로)


DROP TABLE EMP_FK;


--열 데이터를 삭제할때 이 데이터를 참조하고 있는 데이터도 함께삭제하기 => ON DELETE CASCADE 사용:
CREATE TABLE EMP_FK2(
    EMPNO NUMBER(4) CONSTRAINT EMPFK2_EMPNO_PK PRIMARY KEY,
    ENAME VARCHAR(20) NOT NULL,
    DEPTNO NUMBER(2) CONSTRAINT EMPFK2_DEPTNO_FK REFERENCES DEPT_FK(DEPTNO) ON DELETE CASCADE
);

CREATE TABLE DEPT_FK (
    DEPTNO NUMBER(2) CONSTRAINT DEPT_FK_DEPTNO_PK PRIMARY KEY,
    DNAME VARCHAR2(14),
    LOC VARCHAR2(13)
);

SELECT * FROM EMP_FK2;
SELECT * FROM DEPT_FK;


INSERT INTO DEPT_FK(DEPTNO, DNAME, LOC)
VALUES(12, 'a100', 12);


INSERT INTO EMP_FK2(EMPNO, ENAME, DEPTNO)
VALUES(1234, 'a100', 12);


--EMP_FK2테이블에 있는 데이터만 삭제(DEPT_FK테이블에는 데이터 남아있음, FOREIGN KEY이기 때문):
DELETE FROM EMP_FK2
WHERE DEPTNO = 12;


--EMP_FK2테이블, DEPT_FK테이블에 있는 데이터 함께 삭제:
DELETE FROM DEPT_FK
WHERE DEPTNO = 12;
